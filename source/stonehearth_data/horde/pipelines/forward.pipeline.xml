<!-- Forward Shading Pipeline -->
<Pipeline>
   <Setup>
      <RenderTarget id="OUTPUT" depthBuf="true" numColBufs="1" format="RGBA8" scale="1.0" maxSamples="4"/>
      <RenderTarget id="SelectedTemp" numColBufs="1" format="RGBA8" scale="1.0"/>
   </Setup>
   <CommandQueue>
      <Stage id="Depth" link="pipelines/globalSettings.material.xml">
         <SwitchTarget target="OUTPUT" />
         <ClearTarget depthBuf="true" colBuf0="true"/>
         <DrawGeometry context="AMBIENT" class="~Translucent" />
      </Stage>

      <Stage id="Light">
         <DoForwardLightLoop class="~Translucent" noShadows="false"/>
      </Stage>

      <Stage id="Selected">
         <SwitchTarget target="SelectedTemp" />
         <ClearTarget colBuf0="true" />
         <DrawSelected context="SELECTED_SCREENSPACE" />

         <SwitchTarget target="OUTPUT" />
         <BindBuffer sampler="outlineSampler" sourceRT="SelectedTemp" bufIndex="0"/>
         <DrawQuad material="terrain/default_material.xml" context="SELECTED_SCREENSPACE_OUTLINER" />

         <DrawSelected context="AMBIENT"/>
         <DoForwardLightLoop selectedOnly="true" noShadows="false"/>
         <UnbindBuffers />
      </Stage>


      <Stage id="Clouds">
         <DrawGeometry context="CLOUDS" class="~Translucent" />
      </Stage>

      <Stage id="Translucent">
         <DrawGeometry context="TRANSLUCENT" order="BACK_TO_FRONT" />
         <DrawGeometry context="BLUEPRINTS" order="FRONT_TO_BACK"/>
         <DrawGeometry context="DEBUG_SHAPES" />
      </Stage>


      <Stage id="Overlays">
			<DrawOverlays context="OVERLAY" />
		</Stage>

      <Stage id="Final">
         <SwitchTarget target="" />
         <BindBuffer sampler="buf0" sourceRT="OUTPUT" bufIndex="0" />
         <DrawQuad material="pipelines/outline.material.xml" context="DRAW_COLORBUF" />
         <UnbindBuffers />
      </Stage>
	</CommandQueue>
</Pipeline>