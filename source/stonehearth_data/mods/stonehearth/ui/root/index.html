<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8">
   <title>Stonehearth UI</title>
   <link rel="stylesheet" type="text/css" href="/stonehearth/ui/root/css/jqueryui.css" />
   <link type="text/css" rel="stylesheet" href="/stonehearth/ui/root/css/rickshaw.min.css">

   <!-- core radiant libraries -->
   <script src="/radiant/js/external/underscore-1.5.2.js"></script>
   <!--<script src="/radiant/js/external/jquery-1.8.2.min.js"></script> -->
   <script src="/radiant/js/external/jquery-2.0.3.js"></script>
   <script src="/radiant/js/external/simple_class.js"></script>
   <script src="/radiant/js/radiant/core.js"></script>
   <!-- <script src="/radiant/js/radiant/events.js"></script>-->
   <script src="/radiant/js/radiant/object.js"></script>
   <script src="/radiant/js/radiant/trace.js"></script>
   <script src="/radiant/js/radiant/radiant_console.js"></script>

   <!-- ui libraries -->
   <script src="js/libs/less-1.3.3.js"></script>
   <script src="js/libs/jquery-1.10.2.js"></script>
   <script src="js/libs/jquery.hotkeys.js"></script>
   <script src="js/libs/jquery.stonehearth.effects.js"></script>
   <script src="js/libs/jquery-ui-1.10.3.js"></script>
   <script src="js/libs/i18next-1.6.3.js"></script>
   <script src="js/libs/modernizr.custom.js"></script>
   <script src="js/libs/jquery.dlmenu.js"></script>
   <script src="js/libs/jquery.togglegrid.js"></script>
   <script src="js/libs/jquery.tooltipster.js"></script>
   <script src="js/libs/turn.js"></script>

   <script src="js/libs/handlebars-v1.3.0.js"></script>
   <script src="js/libs/ember-1.8.1.js"></script>
   <script src="js/sound.js"></script>
   <script src="js/input.js"></script>

   <script src="js/libs/d3.min.js"></script>
   <script src="js/libs/rickshaw.min.js"></script>

   <!-- the app -->
   <script src="js/app.js"></script>
   <script src="js/helpers.js"></script>
   <script src="js/stonehearth/stonehearth_client.js"></script>
   <script src="js/stonehearth/keyboard.js"></script>
   <script src="js/stonehearth/model.js"></script>
   <script src="js/stonehearth/view.js"></script>
   <script src="js/stonehearth/container_view.js"></script>

   <!-- the root view -->
   <script src="js/root_view.js"></script>

   <!-- start the app -->
   <script>
      i18n.init({
         lng: "en",
         fallbackLng: false,
         ns: "stonehearth",
         resGetPath: '../../../__ns__/locales/__lng__.json'
      });

      window.onerror = function (message, file, line, column, error) {
         //console.log('Error: ' + errorObj.stack);
         var model = {
            message: message,
            file: file,
            line: line,
            error: error,
         }
         if (App.gameView) {
            App.gameView.addView(App.StonehearthJsErrorDialogView, { model : model });
         }
         console.error(message);
         console.error("File:" + file + " Line:" + line);
         console.error(error.stack);

         // the chromum console log is stifled under log level 3.  make sure it
         // makes it into log level by sending the error directly to the client
         radiant.call('radiant:browser_log', error.stack)
         return true;
      }

      window.addEventListener("error", function (e) {
         //console.log(e.error.message, "from", e.error.stack);
      });

      radiant.call('radiant:get_config', 'enable_ember_debugging')
         .done(function(o) {
            if (o.enable_ember_debugging) {
               console.log('"enable_ember_debugging" is true.  Enabling ember debugging support.');
               
               // Lets you find the stack when something blows up on the backburner.  To
               // print it, navigate up the stack to the backburner flush() method from
               // inside the exception handler and inspect the value of
               // errorRecordedForStack.stack.
               Ember.run.backburner.DEBUG = true;

               // Straight from emberjs.com...
               // There are times when dealing with promises that it seems like any errors
               // are being 'swallowed', and not properly raised. This makes it extremely
               // difficult to track down where a given issue is coming from. Thankfully,
               // RSVP has a solution for this problem built in.
               // You can provide an onerror function that will be called with the error
               // details if any errors occur within your promise.
               Ember.RSVP.on('error', function(e) {
                  console.error(e.message); 
                  console.error(e.stack);
               });
            }
         });
   </script>

</head>

<body>

   <script type="text/x-handlebars">
      {{render "Root"}}
      {{outlet 'modal'}}
      {{outlet 'modalmodal'}} <!-- for modals on top of modals....yeah -->
   </script>

</body>
</html>
