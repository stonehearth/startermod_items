
<script type="text/x-handlebars" data-template-name="citizenCharacterSheet">
   <div class="gui">
      <div class="window" id="citizenCharacterSheet">
         <div class="title">
            {{i18n stonehearth:character_sheet_title}}
            <div class="closeButton"></div>
         </div>

         <div id="header">
            <input id="name" onClick="this.select();" type="text" {{bind-attr value=view.model.unit_info.name}} />
            <div id="description"> 
               <img class = "classIconImg" {{bind-attr src=view.currJobIcon}}/>
               <span class = "classNameLvlDesc">
                  {{view.model.stonehearth:job.curr_job_name}}
               </span>
            </div>

            <div id="stats">

               <!-- health -->
               <div class="stat">
                  <div class="label">{{i18n stonehearth:health}}</div>
                  <div class="bar">
                     <div class="healthBar" />
                     <div class="value">{{view.model.stonehearth:attributes.attributes.health.effective_value}} / {{view.model.stonehearth:attributes.attributes.max_health.effective_value}}</div>
                  </div>
               </div>

               <!-- morale -->
               <div class="stat">
                  <div class="label">{{i18n stonehearth:morale}}</div>
                  <div class="bar">
                     <div class="moraleBar" />
                     <div class="value">{{view.score_happiness}} / 10</div>
                  </div>
               </div>

               <!-- experience -->
               <div class="stat" id="experienceStat">
                  {{#if view.model.stonehearth:job.curr_job_controller.no_levels}}
                  {{else}}
                     <div class="label">{{i18n stonehearth:experience}}</div>
                     {{#if view.model.stonehearth:job.curr_job_controller.is_max_level}}
                        <div class = "maxLevelNotice">{{i18n stonehearth:max_level}}</>
                     {{else}}
                        <div class="bar">
                        <div class="expBar" />
                        <div class="value">{{view.model.stonehearth:job.current_level_exp}} / {{view.model.stonehearth:job.xp_to_next_lv}}</div>
                     {{/if}}
                     </div>
                  {{/if}}

               </div>
            </div>
         </div>

         <div id="glass">
            <div id="mind">{{view.model.stonehearth:attributes.attributes.mind.effective_value}}</div>
            <div id="body">{{view.model.stonehearth:attributes.attributes.body.effective_value}}</div>
            <div id="spirit">{{view.model.stonehearth:attributes.attributes.spirit.effective_value}}</div>
         </div>
         <div id="buffs">
            {{#each view.model.buffs}}
               {{#if this.name}}
                  {{#unless this.invisible_to_player}}
                  <div class="item" {{bind-attr title=this.name description=this.description}}>
                     <img {{bind-attr src=this.icon}} />
                  </div>
                  {{/unless}}
               {{/if}}
            {{/each}}
         </div>

         <div id="details" class="downSection">
            <div id="equipmentTab" class="tabPage">
               <table id="equipmentTable" valign="middle">
                  <tr>
                     <td></td>
                     <td><h2>{{i18n stonehearth:equipment}}</h2></td>
                     <td><h2>{{i18n stonehearth:character_sheet_equipment_attack}}</h2></td>
                     <td><h2>{{i18n stonehearth:character_sheet_equipment_defense}}</h2></td>
                  </tr>

                  {{#each equipment_info in view.all_equipment}}
                     <tr class="slotDetail" {{bind-attr id=equipment_info.slotId}}>
                        <td><div class="slotImg"><img class=".equipmentImg" {{bind-attr src=equipment_info.equipment.unit_info.icon}}/></div></td>
                        <td class="slotItemName">{{equipment_info.equipment.unit_info.name}}
                        <td>
                           {{#if equipment_info.equipment.uri.entity_data.stonehearth:combat:weapon_data}}
                              <div class="equipmentDataValue">
                                 +{{equipment_info.equipment.uri.entity_data.stonehearth:combat:weapon_data.base_damage}}
                              </div>
                           {{else}}
                              -
                           {{/if}}
                        </td>
                        <td>
                           {{#if equipment_info.equipment.uri.entity_data.stonehearth:combat:armor_data}}
                              <div class="equipmentDataValue">
                                 +{{equipment_info.equipment.uri.entity_data.stonehearth:combat:armor_data.base_damage_reduction}}
                              </div>
                           {{else}}
                              -
                           {{/if}}
                        </td>
                     </tr>
                  {{/each}}

               </table>
            </div>

            <div id="attributesTab" class="tabPage">
               <h2>{{i18n stonehearth:attributes}}</h2>
               <table class="statsTable">
                  <tr id="diligence" class="attr value"><td>{{i18n stonehearth:diligence_attribute}}<td><div>{{view.model.stonehearth:attributes.attributes.diligence.user_visible_value}}</div>
                  <tr id="curiosity" class="attr value"><td>{{i18n stonehearth:curiosity_attribute}}<td><div>{{view.model.stonehearth:attributes.attributes.curiosity.user_visible_value}}</div>
                  <tr id="inventiveness" class="attr value"><td>{{i18n stonehearth:inventiveness_attribute}}<td><div>{{view.model.stonehearth:attributes.attributes.inventiveness.user_visible_value}}</div>
               </table>
               <br>
               <table class="statsTable">
                  <tr id="muscle" class="attr value"><td>{{i18n stonehearth:muscle_attribute}}<td><div>{{view.model.stonehearth:attributes.attributes.muscle.user_visible_value}}</div>
                  <tr id="speed" class="attr value"><td>{{i18n stonehearth:speed_attribute}}<td><div>{{view.model.stonehearth:attributes.attributes.speed.user_visible_value}}</div>
                  <tr id="stamina" class="attr value"><td>{{i18n stonehearth:stamina_attribute}}<td><div>{{view.model.stonehearth:attributes.attributes.stamina.user_visible_value}}</div>
               </table>
               <br>
               <table class="statsTable">
                  <tr id="courage" class="attr value"><td >{{i18n stonehearth:courage_attribute}}<td><div>{{view.model.stonehearth:attributes.attributes.courage.user_visible_value}}</div>
                  <tr id="willpower" class="attr value"><td>{{i18n stonehearth:willpower_attribute}}<td><div>{{view.model.stonehearth:attributes.attributes.willpower.user_visible_value}}</div>
                  <tr id="compassion" class="attr value"><td>{{i18n stonehearth:compassion_attribute}}<td><div>{{view.model.stonehearth:attributes.attributes.compassion.user_visible_value}}</div>
               </table>
            </div>
            <div id="abilitiesTab" class = "tabPage">
               {{#each view.allJobData}}
                  <div class="jobData" {{bind-attr uri=this.description.alias}}>
                     <div class="className">{{this.name}} <span class="progressionSummary">(<span class="retiredAt">{{i18n stonehearth:retired}} </span><span class="lvlTitle"></span>)</span></div>
                     <div class="jobPerks">
                        {{#each this.description.levelArray}}
                           {{#each this.perks}}
                           <div class="perkDiv tooltip" locked="true" {{bind-attr name=this.name description=this.description divLevel=this.level}}>
                              <img {{bind-attr src=this.icon imgLevel=this.level}}/>
                              <span class="levelLabel" {{bind-attr lbLevel=this.level}}>{{i18n stonehearth:level_abbreviation}} <span class="levelText">{{this.level}}</span></span>
                           </div>
                           {{/each}}
                        {{/each}}
                     </div>
                  </div>
               {{/each}}
            </div>
            <div id="moraleTab" class="tabPage">
               <div id="persona" class="column">
                  <h2>{{i18n stonehearth:happiness}}</h2>
                  <table class="statsTable">
                     <tr id="happiness" class="score value"><td>{{i18n stonehearth:overall_happiness}}<td><div>{{view.score_happiness}}</div>
                     <tr id="food" class="score value"><td>{{i18n stonehearth:happiness_food}}<td><div>{{view.score_food}}</div>
                     <tr id="shelter" class="score value"><td>{{i18n stonehearth:happiness_shelter}}<td><div>{{view.score_shelter}}</div>
                     <tr id="safety" class="score value"><td>{{i18n stonehearth:happiness_safety}}<td><div>{{view.score_safety}}</div>
                  </table>
               </div>
               <div id="journal" class="column">
                  <h2>{{i18n stonehearth:journal}}</h2>
                  <div id="entries">
                     
                     <div class="entry">
                        <p class="date">{{view.model.firstJournalEntry.date}}</p>
                        <p class="entryTitle">{{view.model.firstJournalEntryTitle}}</p> 
                        
                        <div>
                        {{#if view.model.firstJournalEntryScore}}
                           {{#if view.model.firstJournalEntryScoreIsUp}}
                              <div class="scoreIndicator goodEntry"></div>
                           {{else}}
                              <div class="scoreIndicator badEntry"></div>
                           {{/if}}
                        {{/if}}
                        <p>{{view.model.firstJournalEntryText}}</p>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            <div id="backpackTab" class="tabPage">
               <div id="backpackData" class="column">
                  <div id="backpackItemsPalette" class="column"></div>
               </div>
            </div>
         <div>

         <div id="infoTable">
            <table class="statsTable">
               <tr><td>Personality<td id="personality">
               <tr><td>Traits<td id="traits"> TBD. Stay tuned!
               <tr><td>Birthday<td>TBD. Stay tuned!
            </table>
         </div>

         <div id="tabs">
            <div class="tab active" tabPage="equipmentTab">{{i18n stonehearth:equipment}}</div>
            <div class="tab" tabPage="abilitiesTab">{{i18n stonehearth:abilities}}</div>
            <div class="tab" tabPage="attributesTab">{{i18n stonehearth:attributes}}</div>
            <div class="tab" tabPage="moraleTab">{{i18n stonehearth:happiness}}</div>
            <div class="tab" tabPage="backpackTab">{{i18n stonehearth:character_sheet_backpack_tab}}</div>
         </div>

      </div>

   </div>
</script>
